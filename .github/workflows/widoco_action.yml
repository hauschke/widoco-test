name: Generate Ontology Documentation

on:
  workflow_dispatch:
  release:
    types: [published]

permissions:
  contents: write

jobs:
  widoco-docs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Generate documentation with WIDOCO
        run: |
          mkdir -p docs/dev
          mkdir -p docs/logs

          docker run --rm \
            -v "${{ github.workspace }}:/workspace" \
            ghcr.io/dgarijo/widoco:v1.4.25 \
              -ontFile /workspace/vivo.owl \
              -outFolder /workspace/docs/dev \
              -lang en \
              -rewriteAll \
              -includeImportedOntologies \
              -getOntologyMetadata \
            > docs/logs/widoco.log 2>&1

      - name: Show WIDOCO log
        run: |
          echo "===== widoco.log ====="
          cat docs/logs/widoco.log

      - name: Verify output
        run: |
          if [ ! -f docs/dev/index-en.html ]; then
            echo "ERROR: index-en.html not found"
            ls -R docs
            exit 1
          fi

      - name: Commit generated documentation
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: Generate ontology documentation (WIDOCO)
          file_pattern: docs/**
          commit_user_name: github-actions[bot]
          commit_user_email: 41898282+github-actions[bot]@users.noreply.github.com
