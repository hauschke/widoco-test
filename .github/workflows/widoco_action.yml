name: Generate ontology documentation (dev)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  widoco:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Prepare output directories
        run: |
          rm -rf docs/dev
          mkdir -p docs/dev docs/logs
          chmod -R u+rwX docs

      - name: Run WIDOCO
        run: |
          docker run --rm \
            -v "${PWD}:/workspace" \
            dgarijo/widoco \
            java -jar /widoco/widoco.jar \
              -ontFile /workspace/vivo.owl \
              -outFolder /workspace/docs/dev \
              -lang en \
              -rewriteAll \
              -includeImportedOntologies \
              -noPlaceHolderText \
            > /workspace/docs/logs/widoco.log 2>&1

      - name: Show WIDOCO log
        if: always()
        run: |
          cat docs/logs/widoco.log || true

      - name: Commit generated documentation
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: Generate ontology documentation (dev)
          file_pattern: docs/**
